<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.clover.salad.consult.query.mapper.ConsultMapper">

    <!-- ConsultQueryDTO 매핑용 resultMap -->
    <resultMap id="ConsultResultMap" type="com.clover.salad.consult.query.dto.ConsultQueryDTO">
        <id property="id" column="id"/>
        <result property="consultAt" column="consult_at"/>
        <result property="content" column="content"/>
        <result property="isDeleted" column="is_deleted"/>
        <result property="etc" column="etc"/>
        <result property="feedbackScore" column="feedback_score"/>
        <result property="employeeId" column="employee_id"/>
        <result property="customerId" column="customer_id"/>
    </resultMap>

    <!-- 전체 상담 데이터를 조회 (삭제 여부 상관 없음, 관리자 전용) -->
    <select id="findAll" resultMap="ConsultResultMap">
        SELECT id, consult_at, content, is_deleted, etc, feedback_score, employee_id, customer_id
        FROM consultation
    </select>

    <!-- 삭제되지 않은 활성 상담 데이터만 조회 (관리자 전용) -->
    <select id="findAllActive" resultMap="ConsultResultMap">
        SELECT id, consult_at, content, is_deleted, etc, feedback_score, employee_id, customer_id
        FROM consultation
        WHERE is_deleted = FALSE
    </select>

    <!-- 부서명으로 상담 데이터를 조회 (확장 가능: 부서명 기반 조회) -->
    <select id="findByDepartmentName" resultMap="ConsultResultMap" parameterType="string">
        SELECT c.id, c.consult_at, c.content, c.is_deleted, c.etc, c.feedback_score, c.employee_id, c.customer_id
        FROM consultation c
        JOIN employee e ON c.employee_id = e.id
        JOIN department d ON e.department_id = d.id
        WHERE d.name = #{departmentName}
    </select>

    <!-- 직원명으로 상담 데이터를 조회 (확장 가능: 이름 기반 조회) -->
    <select id="findByEmployeeName" resultMap="ConsultResultMap" parameterType="string">
        SELECT c.id, c.consult_at, c.content, c.is_deleted, c.etc, c.feedback_score, c.employee_id, c.customer_id
        FROM consultation c
        JOIN employee e ON c.employee_id = e.id
        WHERE e.name = #{employeeName}
    </select>

</mapper>