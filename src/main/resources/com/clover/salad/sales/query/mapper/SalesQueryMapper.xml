<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.clover.salad.sales.query.mapper.SalesQueryMapper">
    <resultMap id="SalesQueryResultMap" type="com.clover.salad.sales.query.dto.SalesQueryResponseDTO">
        <result property="id" column="id"/>
        <result property="salesDate" column="sales_date"/>
        <result property="department" column="department"/>
        <result property="employeeName" column="employee_name"/>
        <result property="amount" column="amount"/>
        <result property="contractId" column="contract_id"/>
    </resultMap>
    <select id="selectSalesByCondition"
            parameterType="com.clover.salad.sales.query.dto.SalesQueryRequestDTO"
            resultMap="SalesQueryResultMap">
        SELECT
               id
             , sales_date
             , department
             , amount
             , employee_name
             , contract_id
          FROM sales
         WHERE is_deleted = false
        <if test="startDate != null and startDate != ''">
            AND sales_date &gt;= #{startDate}
        </if>
        <if test="endDate != null and endDate != ''">
            AND sales_date &lt;= #{endDate}
        </if>
        <if test="department != null and department != ''">
            AND department LIKE CONCAT('%', #{department}, '%')
        </if>
        <if test="minAmount != null and minAmount &gt;= 0">
            AND amount &gt;= #{minAmount}
        </if>
        <if test="maxAmount != null and maxAmount &gt;= 0">
            AND amount &lt;= #{maxAmount}
        </if>
        <if test="employeeName != null and employeeName != ''">
            AND employee_name LIKE CONCAT('%', #{employeeName}, '%')
        </if>
        <if test="contractId != null and contractId != ''">
            AND CAST(contract_id AS CHAR) LIKE CONCAT('%', #{contractId}, '%')
        </if>
         ORDER BY sales_date DESC
    </select>
</mapper>